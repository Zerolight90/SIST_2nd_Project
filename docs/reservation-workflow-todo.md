# 예매 워크플로우 TODO

## 목적
- 영화 선택 → 좌석 선택 → 결제까지의 사용자 플로우를 일관된 도메인 규칙과 트랜잭션으로 보장한다.
- 결제 모듈 연동 시 실패·재시도 상황에서도 데이터 일관성을 유지하는 예외 처리 흐름을 확보한다.
- 예매·결제 데이터를 MySQL·MyBatis 환경에서 정규화하여 정산·환불까지 이어지는 데이터 파이프라인을 완성한다.

## 작업 항목

### 1. 예매 워크플로우 규칙 정밀화
- [ ] 영화 선택 → 상영 정보 → 좌석 선택 → 결제로 이어지는 단계별 상태 전이 다이어그램 정의
- [ ] 중복 예매 방지를 위한 좌석 락킹 전략(MySQL 트랜잭션 격리, Optimistic Lock 등) 결정 및 SQL 초안 작성
- [ ] 트랜잭션 단위(좌석 확보, 결제 승인, 확정) 명세화 및 롤백 시나리오 문서화

### 2. 결제 모듈 연동 및 예외 처리 플로우
- [ ] 외부 PG 어댑터 인터페이스 초안 작성(요청/응답 DTO, 서명/검증 정책 포함)
- [ ] 임시 저장(Session/Redis 등) 데이터 구조 정의 및 검증 로직 체크리스트 마련
- [ ] 결제 실패·사용자 취소·재시도 시 상태 복구 순서와 로그/알림 포인트 설계

### 3. 데이터 파이프라인 및 정산 로직
- [ ] 예매/결제/환불 테이블 3차 정규화 스키마 정의 및 ERD 업데이트
- [ ] 일자별 정산 리포트 생성 쿼리, 환불 발생 시 좌석 재고 복구 로직 명세
- [ ] MyBatis 매퍼 작업 목록(예약 생성, 좌석 잠금, 결제 상태 업데이트, 정산 리포트) 정리

