<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="payment">

    <insert id="addPayment" parameterType="mybatis.vo.PaymentVO"
            useGeneratedKeys="true" keyProperty="paymentIdx">
        INSERT INTO payment
        (
            userIdx, reservIdx, prodIdx, couponUserIdx, paymentType, orderId,
            paymentTransactionId, paymentMethod, paymentTotal, couponDiscount,
            pointDiscount, paymentFinal, paymentStatus, paymentDate
        )
        VALUES
            (
                #{userIdx}, #{reservIdx}, #{prodIdx}, #{couponUserIdx}, #{paymentType}, #{orderId},
                #{paymentTransactionId}, #{paymentMethod}, #{paymentTotal}, #{couponDiscount},
                #{pointDiscount}, #{paymentFinal}, 0, NOW()
            )
    </insert>

    <update id="updatePaymentStatusAndCancelDate" parameterType="map">
        UPDATE payment
        SET
            paymentStatus = #{paymentStatus},
            paymentCancelDate = #{paymentCancelDate}
        WHERE
            paymentTransactionId = #{paymentKey}
    </update>

    <select id="getPaymentsByUserIdx" parameterType="long" resultType="mybatis.vo.PaymentVO">
        SELECT *
        FROM payment
        WHERE userIdx = #{userIdx}
        ORDER BY paymentDate DESC
    </select>

    <!-- 모든 결제 정보를 가져오는 쿼리 (종민) -->
    <select id="getAllPayment" resultType="mybatis.vo.PaymentVO">
        select * from payment
    </select>

</mapper>