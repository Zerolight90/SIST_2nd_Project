<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="movie">

    <select id="getTotalCount" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM movie
        <where>
            <choose>
                <when test="_parameter == 'boxoffice'">
                    `date` &lt;= NOW()
                </when>
                <when test="_parameter == 'scheduled'">
                    `date` > NOW()
                </when>
                <when test="_parameter == 'sistory'">
                    gen = '역사'
                </when>
                <when test="_parameter == 'filmsociety'">
                    dir = '소마이 신지'
                </when>
                <when test="_parameter == 'classicsociety'">
                    gen = '다큐멘터리'
                </when>
            </choose>
        </where>
    </select>

    <select id="getMovieList" parameterType="java.util.Map" resultType="mybatis.vo.MovieVO">
        SELECT *
        FROM movie
        <where>
            <choose>
                <when test="category == 'boxoffice'">
                    `date` &lt;= NOW()
                </when>
                <when test="category == 'scheduled'">
                    `date` > NOW()
                </when>
                <when test="category == 'sistory'">
                    gen = '역사'
                </when>
                <when test="category == 'filmsociety'">
                    dir = '소마이 신지'
                </when>
                <when test="category == 'classicsociety'">
                    gen = '다큐멘터리'
                </when>
            </choose>
        </where>

        <choose>
            <when test="category == 'boxoffice'"> ORDER BY audNum DESC </when>
            <when test="category == 'scheduled'"> ORDER BY date ASC </when>
            <otherwise> ORDER BY date DESC </otherwise>
        </choose>

        LIMIT #{offset}, #{numPerPage}
    </select>

    <select id="all" resultType="mybatis.vo.MovieVO">
        SELECT * FROM movie
    </select>

    <select id="list" resultType="mybatis.vo.MovieVO" parameterType="String">
        SELECT * FROM movie WHERE mIdx = #{mIdx}
    </select>

    <select id="getMovieInfo" resultType="mybatis.vo.MovieVO">
        SELECT * FROM movie
    </select>

    <select id="getMovieSearch" resultType="mybatis.vo.MovieVO" parameterType="Map">
    </select>

    <select id="searchTotalCount" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM movie
        WHERE name LIKE CONCAT('%', #{keyword}, '%')
    </select>

    <select id="search" parameterType="java.util.Map" resultType="mybatis.vo.MovieVO">
        SELECT *
        FROM movie
        WHERE name LIKE CONCAT('%', #{keyword}, '%')
        ORDER BY date DESC
        LIMIT #{offset}, #{numPerPage}
    </select>

</mapper>