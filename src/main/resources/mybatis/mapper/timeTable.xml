<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="timeTable">


    <resultMap id="map100" type="mybatis.vo.TimeTableVO">
        <id property="mIdx" column="mIdx"/>

        <!-- timeTableVO에 있는 멤버변수들 중 List<Movie> m_list; -->
        <collection property="m_list" ofType="mybatis.vo.MovieVO"
                    select="movie.list" column="mIdx"/>
        <!-- movie.list를 호출하면서 mIdx값을 인자로 보낸다. -->
    </resultMap>

    <select id="all" resultMap="map100" parameterType="String"> <!-- 상영중이거나 상영예정인 영화들만 보여주는 쿼리 -->
        SELECT *
        FROM time_table t
        INNER JOIN movie m
        ON t.mIdx = m.mIdx
        WHERE t.startTime &lt; #{now}
    </select>

    <!-- 각 인자들을 갖고 비교한 쿼리문을 가져왔는데 화면에 mIdx를 보여주는게 아닌 이름을 보여줘야함 -->
    <select id="time" resultMap="map100" parameterType="Map"> <!-- 인자를 두개받아야해서 Map으로 받음 -->
        SELECT *
        FROM time_table
        WHERE startTime &lt; #{date}
        AND endTime &gt; #{date}
        AND mIdx = #{mIdx}
        AND tIdx = #{tIdx}
    </select>

    <select id="select" resultType="mybatis.vo.TimeTableVO" parameterType="mybatis.vo.TimeTableVO">
        SELECT *
        FROM time_table
        WHERE timeTableIdx = #{timeTableIdx}
    </select>

    <select id="getTimetableList" resultType="mybatis.vo.TimeTableVO">
        select m.name, t.timeTableIdx, t.startTime, t.endTime, t.date, r.tName, s.sName, s.sSeatCount
        from time_table t
        inner join movie m ON m.mIdx = t.mIdx
        inner join theater r ON r.tIdx = t.tIdx
        inner join screen s ON s.sIdx = t.sIdx
    </select>
    <select id="getRemainSeat" resultType="mybatis.vo.ReservationVO">
        select * from reservation r
        inner join time_table t ON r.timeTableIdx = t.timeTableIdx
    </select>

</mapper>