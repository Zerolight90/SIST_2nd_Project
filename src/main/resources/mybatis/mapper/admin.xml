<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
    <!--모든 관리자를 구하는 쿼리 (종민)-->
    <select id="getAllAdmin" resultType="mybatis.vo.AdminVO">
        select * from admin
    </select>

    <select id="adminCheck" resultType="mybatis.vo.AdminVO" parameterType="Map">
        select * from admin
        where adminId = #{id} and adminPassword = #{pw}
    </select>

    <select id="adminListSearch" resultType="mybatis.vo.AdminVO" parameterType="Map">
        select * from admin

        <where>
            <if test="admin_status != null and admin_status != ''">
                <choose>
                    <when test="admin_status == 'active'">
                        AND adminstatus = 1
                    </when>
                    <when test="admin_status == 'dormant'">
                        AND adminstatus = 0
                    </when>
                </choose>
            </if>

            <if test="admin_level != null and admin_level != ''">
                <choose>
                    <when test="admin_level == 'manager'">
                        AND adminLevel = "Manager"
                    </when>
                    <when test="admin_level == 'staff'">
                        AND adminLevel = "Staff"
                    </when>
                </choose>
            </if>

            <if test="search_keyword != null and search_keyword != '' and search_field == 'id'">
                AND adminId LIKE CONCAT ('%', #{search_keyword}, '%')
            </if>
        </where>

    </select>

    <select id="salesByTheater" resultType="mybatis.vo.RevenueVO">
        SELECT
        t.tName AS theaterName,
        SUM(p.paymentFinal) AS totalSales
        FROM
        payment p
        JOIN
        reservation r ON p.reservIdx = r.reservIdx
        JOIN
        theater t ON r.tIdx = t.tIdx
        WHERE
        p.paymentStatus = 0 -- 0:결제완료, 1:취소
        GROUP BY
        t.tName
        ORDER BY
        totalSales DESC
    </select>
</mapper>